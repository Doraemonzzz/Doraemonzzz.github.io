<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>计算机程序的构造和解释(SICP) 第1章 习题解析 Part2 | Doraemonzzz</title><meta name="keywords" content="计算机程序的构造和解释"><meta name="author" content="Doraemonzzz"><meta name="copyright" content="Doraemonzzz"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="这次回顾第一章的部分习题。 学习资料： https:&#x2F;&#x2F;ocw.mit.edu&#x2F;courses&#x2F;electrical-engineering-and-computer-science&#x2F;6-001-structure-and-interpretation-of-computer-programs-spring-2005&#x2F;index.htm https:&#x2F;&#x2F;github.com&#x2F;DeathKing&#x2F;L">
<meta property="og:type" content="article">
<meta property="og:title" content="计算机程序的构造和解释(SICP) 第1章 习题解析 Part2">
<meta property="og:url" content="http://doraemonzzz.com/2020/12/06/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%9E%84%E9%80%A0%E5%92%8C%E8%A7%A3%E9%87%8A(SICP)%20%E7%AC%AC1%E7%AB%A0%20%E4%B9%A0%E9%A2%98%E8%A7%A3%E6%9E%90%20Part2/index.html">
<meta property="og:site_name" content="Doraemonzzz">
<meta property="og:description" content="这次回顾第一章的部分习题。 学习资料： https:&#x2F;&#x2F;ocw.mit.edu&#x2F;courses&#x2F;electrical-engineering-and-computer-science&#x2F;6-001-structure-and-interpretation-of-computer-programs-spring-2005&#x2F;index.htm https:&#x2F;&#x2F;github.com&#x2F;DeathKing&#x2F;L">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2020-12-06T08:29:00.000Z">
<meta property="article:modified_time" content="2020-12-06T08:30:42.966Z">
<meta property="article:author" content="Doraemonzzz">
<meta property="article:tag" content="计算机程序的构造和解释">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="https://github.com/Doraemonzzz/md-photo/blob/master/%E5%A4%B4%E5%83%8F.jpg?raw=true"><link rel="canonical" href="http://doraemonzzz.com/2020/12/06/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%9E%84%E9%80%A0%E5%92%8C%E8%A7%A3%E9%87%8A(SICP)%20%E7%AC%AC1%E7%AB%A0%20%E4%B9%A0%E9%A2%98%E8%A7%A3%E6%9E%90%20Part2/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?6f00f37f957f0608abb8c571105456f0";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '计算机程序的构造和解释(SICP) 第1章 习题解析 Part2',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-12-06 16:30:42'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><link rel="stylesheet" href="/css/bilibili.css" media="defer" onload="this.media='all'"><meta name="google-site-verification" content="c4v-NmuUZRgl3cvtg9GKswryK1YLaPztd_5M-df5VNI" /><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Doraemonzzz" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://github.com/Doraemonzzz/md-photo/blob/master/%E5%A4%B4%E5%83%8F.jpg?raw=true" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">611</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">60</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">24</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-chart-pie"></i><span> 博客统计</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/charts/"><i class="fa-fw far fa-chart-bar"></i><span> 文章统计</span></a></li><li><a class="site-page child" href="/census/"><i class="fa-fw fas fa-chart-area"></i><span> 访问统计</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/top/"><i class="fa-fw fab fa-hotjar"></i><span> 阅读排行榜</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Doraemonzzz</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-chart-pie"></i><span> 博客统计</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/charts/"><i class="fa-fw far fa-chart-bar"></i><span> 文章统计</span></a></li><li><a class="site-page child" href="/census/"><i class="fa-fw fas fa-chart-area"></i><span> 访问统计</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/top/"><i class="fa-fw fab fa-hotjar"></i><span> 阅读排行榜</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">计算机程序的构造和解释(SICP) 第1章 习题解析 Part2</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-12-06T08:29:00.000Z" title="发表于 2020-12-06 16:29:00">2020-12-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-12-06T08:30:42.966Z" title="更新于 2020-12-06 16:30:42">2020-12-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8E%9F%E7%90%86/">计算机原理</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>13分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="计算机程序的构造和解释(SICP) 第1章 习题解析 Part2"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div><article class="post-content" id="article-container"><p>这次回顾第一章的部分习题。</p>
<p>学习资料：</p>
<p><a target="_blank" rel="noopener" href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-001-structure-and-interpretation-of-computer-programs-spring-2005/index.htm">https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-001-structure-and-interpretation-of-computer-programs-spring-2005/index.htm</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/DeathKing/Learning-SICP">https://github.com/DeathKing/Learning-SICP</a></p>
<p><a target="_blank" rel="noopener" href="https://mitpress.mit.edu/sites/default/files/sicp/index.html">https://mitpress.mit.edu/sites/default/files/sicp/index.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Xx41117tr?from=search&amp;seid=14983483066585274454">https://www.bilibili.com/video/BV1Xx41117tr?from=search&amp;seid=14983483066585274454</a></p>
<p>参考资料：</p>
<p><a target="_blank" rel="noopener" href="https://sicp.readthedocs.io/en/latest">https://sicp.readthedocs.io/en/latest</a></p>
<span id="more"></span>
<h4 id="1-16-p30"><a href="#1-16-p30" class="headerlink" title="1.16(p30)"></a>1.16(p30)</h4><p>利用如下事实即可：</p>
<script type="math/tex; mode=display">
b^n = (b^{2})^{n/2}= (b^{n/2})^2, n=2k</script><p>代码如下：</p>
<pre class="line-numbers language-scheme" data-language="scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">expt-iter</span> b counter product<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">cond</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">=</span> counter <span class="token number">0</span><span class="token punctuation">)</span> product<span class="token punctuation">)</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">even?</span> counter<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">expt-iter</span> <span class="token punctuation">(</span><span class="token operator">*</span> b b<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">/</span> counter <span class="token number">2</span><span class="token punctuation">)</span> product<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">(</span><span class="token keyword">else</span> <span class="token punctuation">(</span><span class="token function">expt-iter</span> b <span class="token punctuation">(</span><span class="token operator">-</span> counter <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span> product b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token builtin">expt</span> b n<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token function">expt-iter</span> b n <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token builtin">even?</span> n<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">remainder</span> n <span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="1-17-p31"><a href="#1-17-p31" class="headerlink" title="1.17(p31)"></a>1.17(p31)</h4><p>原始递归方法：</p>
<script type="math/tex; mode=display">
\mathrm{prod}(a, b)=\begin{cases}
0 & b=0\\
\mathrm{prod}(a, b - 1) + a & b>0
\end{cases}</script><p>快速求法：</p>
<script type="math/tex; mode=display">
\mathrm{prod}(a, b)=\begin{cases}
0 & b=0\\
\mathrm{prod}(a, b/2) + \mathrm{prod}(a, b/2) & b=2k, k\ge 1\\
\mathrm{prod}(a, b -1) + a& b=2k-1, k\ge 1
\end{cases}</script><p>代码如下：</p>
<pre class="line-numbers language-scheme" data-language="scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">double</span> a<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token operator">+</span> a a<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">halve</span> n<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token operator">/</span> n <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token builtin">even?</span> n<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">remainder</span> n <span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token operator">*</span> a b<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token keyword">cond</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">=</span> b <span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span>
          <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">even?</span> b<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">double</span> <span class="token punctuation">(</span><span class="token operator">*</span> a <span class="token punctuation">(</span><span class="token function">halve</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">(</span><span class="token keyword">else</span> <span class="token punctuation">(</span><span class="token operator">+</span> a <span class="token punctuation">(</span><span class="token operator">*</span> a <span class="token punctuation">(</span><span class="token operator">-</span> b <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="1-18-p31"><a href="#1-18-p31" class="headerlink" title="1.18(p31)"></a>1.18(p31)</h4><p>将前一个过程改写成迭代的形式：</p>
<pre class="line-numbers language-scheme" data-language="scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">double</span> a<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token operator">+</span> a a<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">halve</span> n<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token operator">/</span> n <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token builtin">even?</span> n<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">remainder</span> n <span class="token number">2</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">prod-iter</span> a b product<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token keyword">cond</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">=</span> b <span class="token number">0</span><span class="token punctuation">)</span> product<span class="token punctuation">)</span>
          <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">even?</span> b<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">+</span> product <span class="token punctuation">(</span><span class="token function">double</span> <span class="token punctuation">(</span><span class="token function">prod-iter</span> a <span class="token punctuation">(</span><span class="token function">halve</span> b<span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">(</span><span class="token keyword">else</span> <span class="token punctuation">(</span><span class="token function">prod-iter</span> a <span class="token punctuation">(</span><span class="token operator">-</span> b <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">+</span> product a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token operator">*</span> a b<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token function">prod-iter</span> a b <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="1-19-p31"><a href="#1-19-p31" class="headerlink" title="1.19(p31)"></a>1.19(p31)</h4><p>证明：</p>
<script type="math/tex; mode=display">
\begin{aligned}
T_{pq}^2 (a, b)
&= T_{pq}(bq + aq + ap, bp+aq)\\
&=((bp+aq) q + (bq + aq + ap)q + (bq + aq + ap)p, ( bp+aq)p + (bq + aq + ap)q)\\
&= (b(q^2+2pq) + a(q^2+2pq) + a(p^2 + q^2), b(p^2+ q^2) + a(q^2 + 2pq))\\
&= T_{p'q'}(a,b)\\
p'&= p^2 + q^2\\
q'&= q^2 + 2pq
\end{aligned}</script><p>转换成代码即为：</p>
<pre class="line-numbers language-scheme" data-language="scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">fib</span> n<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">fib-iter</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">1</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">fib-iter</span> a b p q count<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">cond</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">=</span> count <span class="token number">0</span><span class="token punctuation">)</span> b<span class="token punctuation">)</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">even?</span> count<span class="token punctuation">)</span>
         <span class="token punctuation">(</span><span class="token function">fib-iter</span> a
                   b
                   <span class="token punctuation">(</span><span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">*</span> p p<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span> q q<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">; compute p'</span>
                   <span class="token punctuation">(</span><span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">*</span> q q<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span> <span class="token number">2</span> <span class="token punctuation">(</span><span class="token operator">*</span> p q<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">; compute q'</span>
                   <span class="token punctuation">(</span><span class="token operator">/</span> count <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">(</span><span class="token keyword">else</span> <span class="token punctuation">(</span><span class="token function">fib-iter</span> <span class="token punctuation">(</span><span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">*</span> b q<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span> a q<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span> a p<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">(</span><span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">*</span> b p<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span> a q<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        p
                        q
                        <span class="token punctuation">(</span><span class="token operator">-</span> count <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">; for test</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">fib1</span> n<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">fib1-iter</span> <span class="token number">1</span> <span class="token number">0</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">fib1-iter</span> a b count<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">=</span> count <span class="token number">0</span><span class="token punctuation">)</span>
      b
      <span class="token punctuation">(</span><span class="token function">fib1-iter</span> <span class="token punctuation">(</span><span class="token operator">+</span> a b<span class="token punctuation">)</span> a <span class="token punctuation">(</span><span class="token operator">-</span> count <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">test</span> f1 f2 n<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">cond</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token function">f1</span> n<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">f2</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span> 
          <span class="token punctuation">(</span><span class="token function">display</span> <span class="token string">"error"</span><span class="token punctuation">)</span>
          <span class="token punctuation">(</span><span class="token builtin">newline</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token function">f1</span> n<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">f2</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">(</span><span class="token function">display</span> <span class="token string">"error"</span><span class="token punctuation">)</span>
          <span class="token punctuation">(</span><span class="token builtin">newline</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token function">test</span> fib fib1 <span class="token number">100</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>一点思考：</p>
<p>题目中的变换是如何想到的，斐波那契数列为何能用对数时间复杂度计算？</p>
<p>将题目中递推公式写成矩阵形式可得：</p>
<script type="math/tex; mode=display">
\begin{aligned}
 \left(
 \begin{matrix}
bq + aq + ap\\
 bp+aq
  \end{matrix}
  \right)
 &= 
     \left(
 \begin{matrix}
p+q & q\\
q & p
  \end{matrix}
  \right)

   \left(
 \begin{matrix}
a\\
b
  \end{matrix}
  \right)\\
  &\triangleq A_{pq}   \left(
 \begin{matrix}
a\\
b
  \end{matrix}
  \right)

  \end{aligned}</script><p>特别的：</p>
<script type="math/tex; mode=display">
\begin{aligned}
 A_{pq} ^2 &= \left(
 \begin{matrix}
p+q & q\\
q & p
  \end{matrix}
  \right)^2\\
 &= \left(
 \begin{matrix}
q^2 +2pq & q^2 +2pq\\
q^2 +2pq & q^2 + pq
  \end{matrix}
  \right)\\
 &=A_{p'q'}\\
  p'&= p^2 + q^2\\
q'&= q^2 + 2pq
  \end{aligned}</script><p>所以上式用矩阵形式理解更方便。</p>
<p>不过上述形式还是比较难凑出的，这里给出一个一般的方法，对每个线性递推式，必然存在一个对应的矩阵$A$，递推实际上是计算$A^n$，如果$A$可对角化，即</p>
<script type="math/tex; mode=display">
A=P\Lambda P^{-1}</script><p>那么</p>
<script type="math/tex; mode=display">
A^n= P \Lambda^n P^{-1}</script><p>由于$\Lambda$是对角阵，所以只要计算对角元即可，可以利用快速幂的方法在对数时间复杂度内计算。</p>
<h4 id="1-20-p33"><a href="#1-20-p33" class="headerlink" title="1.20(p33)"></a>1.20(p33)</h4><p>参考资料：</p>
<p><a target="_blank" rel="noopener" href="https://sicp.readthedocs.io/en/latest/chp1/20.html">https://sicp.readthedocs.io/en/latest/chp1/20.html</a></p>
<p>应用序：remainder调用次数为5次。</p>
<pre class="line-numbers language-scheme" data-language="scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token builtin">gcd</span> <span class="token number">206</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token comment">; 1</span>
<span class="token punctuation">(</span><span class="token builtin">gcd</span> <span class="token number">40</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token comment">; 2</span>
<span class="token punctuation">(</span><span class="token builtin">gcd</span> <span class="token number">6</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">; 3</span>
<span class="token punctuation">(</span><span class="token builtin">gcd</span> <span class="token number">4</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">; 4</span>
<span class="token punctuation">(</span><span class="token builtin">gcd</span> <span class="token number">2</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>正则序：</p>
<pre class="line-numbers language-scheme" data-language="scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token builtin">gcd</span> <span class="token number">206</span> <span class="token number">40</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token builtin">gcd</span> <span class="token number">40</span> <span class="token punctuation">(</span><span class="token builtin">remainder</span> <span class="token number">206</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">; t1 = (remainder 206 40) = 6, 1</span>
<span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">=</span> t1 <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">; #f</span>
<span class="token punctuation">(</span><span class="token builtin">gcd</span> t1 <span class="token punctuation">(</span><span class="token builtin">remainder</span> <span class="token number">40</span> t1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">; t2 = (remainder 40 t1) = (remainder 40 6) = 4, 2</span>
<span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">=</span> t2 <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">; #f</span>
<span class="token punctuation">(</span><span class="token builtin">gcd</span> t2 <span class="token punctuation">(</span><span class="token builtin">remainder</span> t1 t2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">; t3 = (remainder t1 t2) = (remainder 6 4) = 2, 3</span>
<span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">=</span> t3 <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">; #f</span>
<span class="token punctuation">(</span><span class="token builtin">gcd</span> t3 <span class="token punctuation">(</span><span class="token builtin">remainder</span> t2 t3<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">; t4 = (remainder t2 t3) = (remainder 4 2) = 0, 4</span>
<span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">=</span> t4 <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">; #t</span>
t3
<span class="token punctuation">(</span><span class="token builtin">remainder</span> t1 t2<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token builtin">remainder</span> t1 <span class="token punctuation">(</span><span class="token builtin">remainder</span> <span class="token number">40</span> t1<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token builtin">remainder</span> t1 <span class="token punctuation">(</span><span class="token builtin">remainder</span> <span class="token number">40</span> <span class="token punctuation">(</span><span class="token builtin">remainder</span> <span class="token number">206</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">; 5</span>
<span class="token punctuation">(</span><span class="token builtin">remainder</span> t1 <span class="token punctuation">(</span><span class="token builtin">remainder</span> <span class="token number">40</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">; 6</span>
<span class="token punctuation">(</span><span class="token builtin">remainder</span> t1 <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token builtin">remainder</span> <span class="token punctuation">(</span><span class="token builtin">remainder</span> <span class="token number">206</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">; 7</span>
<span class="token punctuation">(</span><span class="token builtin">remainder</span> <span class="token number">6</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">; 8 </span>
<span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>remainder调用次数为8次。</p>
<h4 id="1-21-p35"><a href="#1-21-p35" class="headerlink" title="1.21(p35)"></a>1.21(p35)</h4><pre class="line-numbers language-scheme" data-language="scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token function">display</span> <span class="token punctuation">(</span><span class="token function">smallest-divisor</span> <span class="token number">199</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token builtin">newline</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">display</span> <span class="token punctuation">(</span><span class="token function">smallest-divisor</span> <span class="token number">1999</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token builtin">newline</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">display</span> <span class="token punctuation">(</span><span class="token function">smallest-divisor</span> <span class="token number">19999</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token builtin">newline</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>得到结果：</p>
<pre class="line-numbers language-none"><code class="language-none">199
1999
7<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="1-22-p35"><a href="#1-22-p35" class="headerlink" title="1.22(p35)"></a>1.22(p35)</h4><p>参考资料：<a target="_blank" rel="noopener" href="https://www.scheme.com/csug8/system.html#./system:h10">https://www.scheme.com/csug8/system.html#./system:h10</a></p>
<p>Chez Scheme不包含runtime函数，这里使用如下方式计算时间：</p>
<pre class="line-numbers language-scheme" data-language="scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">runtime</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token function">real-time</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>完整的代码如下：</p>
<pre class="line-numbers language-scheme" data-language="scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">runtime</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token function">real-time</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token builtin">square</span> a<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token operator">*</span> a a<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">smallest-divisor</span> n<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">find-divisor</span> n <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">find-divisor</span> n test-divisor<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">cond</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token builtin">square</span> test-divisor<span class="token punctuation">)</span> n<span class="token punctuation">)</span> n<span class="token punctuation">)</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">divides?</span> test-divisor n<span class="token punctuation">)</span> test-divisor<span class="token punctuation">)</span>
        <span class="token punctuation">(</span><span class="token keyword">else</span> <span class="token punctuation">(</span><span class="token function">find-divisor</span> n <span class="token punctuation">(</span><span class="token operator">+</span> test-divisor <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">divides?</span> a b<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">remainder</span> b a<span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">prime?</span> n<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token operator">=</span> n <span class="token punctuation">(</span><span class="token function">smallest-divisor</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">;;</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">report-prime</span> n<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">display</span> n<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">display</span> <span class="token string">" is prime."</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token builtin">newline</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">report-time</span> elapsed-time<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">display</span> <span class="token string">"time is :"</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">display</span> elapsed-time<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token builtin">newline</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">search-for-primes</span> n<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token keyword">define</span> start-time <span class="token punctuation">(</span><span class="token function">runtime</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token function">search-for-primes-iter</span> <span class="token punctuation">(</span><span class="token operator">+</span> n <span class="token number">1</span><span class="token punctuation">)</span> start-time <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">search-for-primes-iter</span> n start-time num<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token keyword">cond</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">=</span> num <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">report-time</span> <span class="token punctuation">(</span><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token function">runtime</span><span class="token punctuation">)</span> start-time<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">prime?</span> n<span class="token punctuation">)</span> 
           <span class="token punctuation">(</span><span class="token function">report-prime</span> n<span class="token punctuation">)</span>
           <span class="token punctuation">(</span><span class="token function">search-for-primes-iter</span> <span class="token punctuation">(</span><span class="token operator">+</span> n <span class="token number">1</span><span class="token punctuation">)</span> start-time <span class="token punctuation">(</span><span class="token operator">-</span> num <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">(</span><span class="token keyword">else</span> 
           <span class="token punctuation">(</span><span class="token function">search-for-primes-iter</span> <span class="token punctuation">(</span><span class="token operator">+</span> n <span class="token number">1</span><span class="token punctuation">)</span> start-time num<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">; for test</span>
<span class="token punctuation">(</span><span class="token function">search-for-primes</span> <span class="token number">1000000</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">search-for-primes</span> <span class="token number">10000000</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">search-for-primes</span> <span class="token number">100000000</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">search-for-primes</span> <span class="token number">1000000000</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">search-for-primes</span> <span class="token number">10000000000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果如下：</p>
<pre class="line-numbers language-none"><code class="language-none">1000003 is prime.
1000033 is prime.
1000037 is prime.
time is :6
10000019 is prime.
10000079 is prime.
10000103 is prime.
time is :1
100000007 is prime.
100000037 is prime.
100000039 is prime.
time is :1
1000000007 is prime.
1000000009 is prime.
1000000021 is prime.
time is :2
10000000019 is prime.
10000000033 is prime.
10000000061 is prime.
time is :9<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果并不是按照$\sqrt{10}$成倍增长，原因应该是$n$的数量级还不够大。</p>
<h4 id="1-23-p36"><a href="#1-23-p36" class="headerlink" title="1.23(p36)"></a>1.23(p36)</h4><p>代码如下：</p>
<pre class="line-numbers language-scheme" data-language="scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">runtime</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token function">real-time</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token builtin">square</span> a<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token operator">*</span> a a<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">next</span> test-divisor<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">=</span> test-divisor <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token number">3</span>
        <span class="token punctuation">(</span><span class="token operator">+</span> test-divisor <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">smallest-divisor</span> n<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">find-divisor</span> n <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">find-divisor</span> n test-divisor<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">cond</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token builtin">square</span> test-divisor<span class="token punctuation">)</span> n<span class="token punctuation">)</span> n<span class="token punctuation">)</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">divides?</span> test-divisor n<span class="token punctuation">)</span> test-divisor<span class="token punctuation">)</span>
        <span class="token punctuation">(</span><span class="token keyword">else</span> <span class="token punctuation">(</span><span class="token function">find-divisor</span> n <span class="token punctuation">(</span><span class="token function">next</span> test-divisor<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">divides?</span> a b<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">remainder</span> b a<span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">prime?</span> n<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token operator">=</span> n <span class="token punctuation">(</span><span class="token function">smallest-divisor</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">;;</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">report-prime</span> n<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">display</span> n<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">display</span> <span class="token string">" is prime."</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token builtin">newline</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">report-time</span> elapsed-time<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">display</span> <span class="token string">"time is :"</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">display</span> elapsed-time<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token builtin">newline</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">search-for-primes</span> n<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token keyword">define</span> start-time <span class="token punctuation">(</span><span class="token function">runtime</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token function">search-for-primes-iter</span> <span class="token punctuation">(</span><span class="token operator">+</span> n <span class="token number">1</span><span class="token punctuation">)</span> start-time <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">search-for-primes-iter</span> n start-time num<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token keyword">cond</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">=</span> num <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">report-time</span> <span class="token punctuation">(</span><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token function">runtime</span><span class="token punctuation">)</span> start-time<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">prime?</span> n<span class="token punctuation">)</span> 
           <span class="token punctuation">(</span><span class="token function">report-prime</span> n<span class="token punctuation">)</span>
           <span class="token punctuation">(</span><span class="token function">search-for-primes-iter</span> <span class="token punctuation">(</span><span class="token operator">+</span> n <span class="token number">1</span><span class="token punctuation">)</span> start-time <span class="token punctuation">(</span><span class="token operator">-</span> num <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">(</span><span class="token keyword">else</span> 
           <span class="token punctuation">(</span><span class="token function">search-for-primes-iter</span> <span class="token punctuation">(</span><span class="token operator">+</span> n <span class="token number">1</span><span class="token punctuation">)</span> start-time num<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token function">search-for-primes</span> <span class="token number">1000000</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">search-for-primes</span> <span class="token number">10000000</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">search-for-primes</span> <span class="token number">100000000</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">search-for-primes</span> <span class="token number">1000000000</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">search-for-primes</span> <span class="token number">10000000000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果：</p>
<pre class="line-numbers language-none"><code class="language-none">1000003 is prime.  
1000033 is prime.  
1000037 is prime.  
time is :0
10000019 is prime. 
10000079 is prime. 
10000103 is prime. 
time is :1
100000007 is prime.
100000037 is prime.
100000039 is prime.
time is :4
1000000007 is prime.
1000000009 is prime.
1000000021 is prime.
time is :2
10000000019 is prime.
10000000033 is prime.
10000000061 is prime.
time is :3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果和预期不同，原因应该是$n$的数量级还不够大。</p>
<h4 id="1-24-p36"><a href="#1-24-p36" class="headerlink" title="1.24(p36)"></a>1.24(p36)</h4><p>代码按如下：</p>
<pre class="line-numbers language-scheme" data-language="scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">runtime</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token function">real-time</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token builtin">square</span> a<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token operator">*</span> a a<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> true <span class="token boolean">#t</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> false <span class="token boolean">#f</span><span class="token punctuation">)</span>

<span class="token comment">;; fast-prime?</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">expmod</span> base exp m<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">cond</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">=</span> exp <span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">even?</span> exp<span class="token punctuation">)</span>
         <span class="token punctuation">(</span><span class="token builtin">remainder</span> <span class="token punctuation">(</span><span class="token builtin">square</span> <span class="token punctuation">(</span><span class="token function">expmod</span> base <span class="token punctuation">(</span><span class="token operator">/</span> exp <span class="token number">2</span><span class="token punctuation">)</span> m<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    m<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">(</span><span class="token keyword">else</span>
         <span class="token punctuation">(</span><span class="token builtin">remainder</span> <span class="token punctuation">(</span><span class="token operator">*</span> base <span class="token punctuation">(</span><span class="token function">expmod</span> base <span class="token punctuation">(</span><span class="token operator">-</span> exp <span class="token number">1</span><span class="token punctuation">)</span> m<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">fermat-test</span> n<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">try-it</span> a<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">expmod</span> a n n<span class="token punctuation">)</span> a<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">try-it</span> <span class="token punctuation">(</span><span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">(</span><span class="token function">random</span> <span class="token punctuation">(</span><span class="token operator">-</span> n <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">fast-prime?</span> n times<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">cond</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">=</span> times <span class="token number">0</span><span class="token punctuation">)</span> true<span class="token punctuation">)</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">fermat-test</span> n<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">fast-prime?</span> n <span class="token punctuation">(</span><span class="token operator">-</span> times <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">(</span><span class="token keyword">else</span> false<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">;;</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">report-prime</span> n<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">display</span> n<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">display</span> <span class="token string">" is prime."</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token builtin">newline</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">report-time</span> elapsed-time<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">display</span> <span class="token string">"time is :"</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">display</span> elapsed-time<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token builtin">newline</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">search-for-primes</span> n<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token keyword">define</span> start-time <span class="token punctuation">(</span><span class="token function">runtime</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token function">search-for-primes-iter</span> <span class="token punctuation">(</span><span class="token operator">+</span> n <span class="token number">1</span><span class="token punctuation">)</span> start-time <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">search-for-primes-iter</span> n start-time num<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token keyword">cond</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">=</span> num <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">report-time</span> <span class="token punctuation">(</span><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token function">runtime</span><span class="token punctuation">)</span> start-time<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">fast-prime?</span> n <span class="token number">10</span><span class="token punctuation">)</span> 
           <span class="token punctuation">(</span><span class="token function">report-prime</span> n<span class="token punctuation">)</span>
           <span class="token punctuation">(</span><span class="token function">search-for-primes-iter</span> <span class="token punctuation">(</span><span class="token operator">+</span> n <span class="token number">1</span><span class="token punctuation">)</span> start-time <span class="token punctuation">(</span><span class="token operator">-</span> num <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">(</span><span class="token keyword">else</span> 
           <span class="token punctuation">(</span><span class="token function">search-for-primes-iter</span> <span class="token punctuation">(</span><span class="token operator">+</span> n <span class="token number">1</span><span class="token punctuation">)</span> start-time num<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token function">search-for-primes</span> <span class="token number">1000000</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">search-for-primes</span> <span class="token number">10000000</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">search-for-primes</span> <span class="token number">100000000</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">search-for-primes</span> <span class="token number">1000000000</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">search-for-primes</span> <span class="token number">10000000000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>实验结果：</p>
<pre class="line-numbers language-none"><code class="language-none">1000003 is prime.
1000033 is prime.
1000037 is prime.
1000039 is prime.
1000081 is prime.
1000099 is prime.
1000117 is prime.
1000121 is prime.
1000133 is prime.
1000151 is prime.
1000159 is prime.
1000171 is prime.
time is :1
10000019 is prime.
10000079 is prime.
10000103 is prime.
10000121 is prime.
10000139 is prime.
10000141 is prime.
10000169 is prime.
10000189 is prime.
10000223 is prime.
10000229 is prime.
10000247 is prime.
10000253 is prime.
time is :3
100000007 is prime.
100000037 is prime.
100000039 is prime.
100000049 is prime.
100000073 is prime.
100000081 is prime.
100000123 is prime.
100000127 is prime.
100000193 is prime.
100000213 is prime.
100000217 is prime.
100000223 is prime.
time is :3
1000000007 is prime.
1000000009 is prime.
1000000021 is prime.
1000000033 is prime.
1000000087 is prime.
1000000093 is prime.
1000000097 is prime.
1000000103 is prime.
1000000123 is prime.
1000000181 is prime.
1000000207 is prime.
1000000223 is prime.
time is :2
10000000019 is prime.
10000000033 is prime.
10000000061 is prime.
10000000069 is prime.
10000000097 is prime.
10000000103 is prime.
10000000121 is prime.
10000000141 is prime.
10000000147 is prime.
10000000207 is prime.
10000000259 is prime.
10000000277 is prime.
time is :13<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这次增加了$n$，但是和期望的结果仍然有差距，个人认为仍然是数量级的原因。</p>
<h4 id="1-25-p36"><a href="#1-25-p36" class="headerlink" title="1.25(p36)"></a>1.25(p36)</h4><p>不正确，因为$a^n$可能溢出。</p>
<h4 id="1-26-p36"><a href="#1-26-p36" class="headerlink" title="1.26(p36)"></a>1.26(p36)</h4><pre class="line-numbers language-scheme" data-language="scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token function">expmod</span> base <span class="token punctuation">(</span><span class="token operator">/</span> exp <span class="token number">2</span><span class="token punctuation">)</span> m<span class="token punctuation">)</span>
   <span class="token punctuation">(</span><span class="token function">expmod</span> base <span class="token punctuation">(</span><span class="token operator">/</span> exp <span class="token number">2</span><span class="token punctuation">)</span> m<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>根据应用序，上述代码会计算两次(expmod base (/ exp 2) m)，所以时间复杂度的关系为</p>
<script type="math/tex; mode=display">
T(n) =2T(n/ 2)</script><p>所以是线性时间复杂度。</p>
<h4 id="1-27-p36"><a href="#1-27-p36" class="headerlink" title="1.27(p36)"></a>1.27(p36)</h4><pre class="line-numbers language-scheme" data-language="scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token builtin">square</span> a<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token operator">*</span> a a<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">expmod</span> base exp m<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">cond</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">=</span> exp <span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">even?</span> exp<span class="token punctuation">)</span>
         <span class="token punctuation">(</span><span class="token builtin">remainder</span> <span class="token punctuation">(</span><span class="token builtin">square</span> <span class="token punctuation">(</span><span class="token function">expmod</span> base <span class="token punctuation">(</span><span class="token operator">/</span> exp <span class="token number">2</span><span class="token punctuation">)</span> m<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    m<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">(</span><span class="token keyword">else</span>
         <span class="token punctuation">(</span><span class="token builtin">remainder</span> <span class="token punctuation">(</span><span class="token operator">*</span> base <span class="token punctuation">(</span><span class="token function">expmod</span> base <span class="token punctuation">(</span><span class="token operator">-</span> exp <span class="token number">1</span><span class="token punctuation">)</span> m<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">fermat-test</span> n m<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">try-it</span> a<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">expmod</span> a n n<span class="token punctuation">)</span> a<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">try-it</span> m<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">Carmichael-test</span> n<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">try-it</span> a<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">expmod</span> a n n<span class="token punctuation">)</span> a<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">iter</span> m<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token keyword">cond</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">=</span> m n<span class="token punctuation">)</span> <span class="token boolean">#t</span><span class="token punctuation">)</span>
          <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">try-it</span> m<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">iter</span> <span class="token punctuation">(</span><span class="token operator">+</span> m <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">(</span><span class="token keyword">else</span> <span class="token boolean">#f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token function">iter</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">; for test</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">test</span> n<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token function">display</span> n<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token function">display</span> <span class="token string">" "</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token function">display</span> <span class="token punctuation">(</span><span class="token function">Carmichael-test</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token builtin">newline</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token function">test</span> <span class="token number">561</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">test</span> <span class="token number">1105</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">test</span> <span class="token number">1729</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">test</span> <span class="token number">2465</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">test</span> <span class="token number">2821</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">test</span> <span class="token number">6601</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>测试结果：</p>
<pre class="line-numbers language-none"><code class="language-none">561 #t
1105 #t
1729 #t
2465 #t
2821 #t
6601 #t<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="1-28-p37"><a href="#1-28-p37" class="headerlink" title="1.28(p37)"></a>1.28(p37)</h4><p>参考资料：</p>
<p><a target="_blank" rel="noopener" href="https://sicp.readthedocs.io/en/latest/chp1/28.html">https://sicp.readthedocs.io/en/latest/chp1/28.html</a></p>
<p>代码如下：</p>
<pre class="line-numbers language-scheme" data-language="scheme"><code class="language-scheme"><span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token builtin">square</span> a<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token operator">*</span> a a<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> true <span class="token boolean">#t</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> false <span class="token boolean">#f</span><span class="token punctuation">)</span>

<span class="token comment">; 判断是不是1取模n的非平凡平方根</span>
<span class="token comment">; 不等于1, n - 1, 平方模n不等于1</span>
<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">square-mod-test</span> a n<span class="token punctuation">)</span>
    <span class="token punctuation">(</span><span class="token builtin">and</span> <span class="token punctuation">(</span><span class="token builtin">not</span> <span class="token punctuation">(</span><span class="token operator">=</span> a <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token punctuation">(</span><span class="token builtin">not</span> <span class="token punctuation">(</span><span class="token operator">=</span> a <span class="token punctuation">(</span><span class="token operator">-</span> n <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token punctuation">(</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">remainder</span> <span class="token punctuation">(</span><span class="token builtin">square</span> a<span class="token punctuation">)</span> n<span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">expmod</span> base exp m<span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token keyword">cond</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">=</span> exp <span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">square-mod-test</span> base m<span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">even?</span> exp<span class="token punctuation">)</span>
         <span class="token punctuation">(</span><span class="token builtin">remainder</span> <span class="token punctuation">(</span><span class="token builtin">square</span> <span class="token punctuation">(</span><span class="token function">expmod</span> base <span class="token punctuation">(</span><span class="token operator">/</span> exp <span class="token number">2</span><span class="token punctuation">)</span> m<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    m<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">(</span><span class="token keyword">else</span>
         <span class="token punctuation">(</span><sp