<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Stanford Compiler PA3 | Doraemonzzz</title><meta name="keywords" content="斯坦福大学编译原理"><meta name="author" content="Doraemonzzz"><meta name="copyright" content="Doraemonzzz"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="课程主页： https:&#x2F;&#x2F;www.edx.org&#x2F;course&#x2F;compilers 课程视频： https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1NE411376V?p&#x3D;20&amp;t&#x3D;6 参考资料： https:&#x2F;&#x2F;github.com&#x2F;dychen&#x2F;compilers&#x2F;tree&#x2F;master&#x2F;PA3 https:&#x2F;&#x2F;github.com&#x2F;yifanyang96&#x2F;Compi">
<meta property="og:type" content="article">
<meta property="og:title" content="Stanford Compiler PA3">
<meta property="og:url" content="http://www.doraemonzzz.com/2021/04/24/2021-4-24-Stanford-Compiler-PA3/index.html">
<meta property="og:site_name" content="Doraemonzzz">
<meta property="og:description" content="课程主页： https:&#x2F;&#x2F;www.edx.org&#x2F;course&#x2F;compilers 课程视频： https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1NE411376V?p&#x3D;20&amp;t&#x3D;6 参考资料： https:&#x2F;&#x2F;github.com&#x2F;dychen&#x2F;compilers&#x2F;tree&#x2F;master&#x2F;PA3 https:&#x2F;&#x2F;github.com&#x2F;yifanyang96&#x2F;Compi">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2021-04-24T10:24:00.000Z">
<meta property="article:modified_time" content="2021-04-24T14:18:59.147Z">
<meta property="article:author" content="Doraemonzzz">
<meta property="article:tag" content="斯坦福大学编译原理">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="https://github.com/Doraemonzzz/md-photo/blob/master/%E5%A4%B4%E5%83%8F.jpg?raw=true"><link rel="canonical" href="http://www.doraemonzzz.com/2021/04/24/2021-4-24-Stanford-Compiler-PA3/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?6f00f37f957f0608abb8c571105456f0";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-G-RE4B1LKRZD"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-G-RE4B1LKRZD');
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"距离上次更新已经","messageNext":"天了，文章内容可能已经过时。"},
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isanchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Stanford Compiler PA3',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-04-24 22:18:59'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><link rel="stylesheet" href="/css/bilibili.css" media="defer" onload="this.media='all'"><meta name="google-site-verification" content="c4v-NmuUZRgl3cvtg9GKswryK1YLaPztd_5M-df5VNI" /><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Doraemonzzz" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src= "/img/loading.gif" data-lazy-src="https://github.com/Doraemonzzz/md-photo/blob/master/%E5%A4%B4%E5%83%8F.jpg?raw=true" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">786</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">79</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">32</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-chart-pie"></i><span> 博客统计</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/charts/"><i class="fa-fw far fa-chart-bar"></i><span> 文章统计</span></a></li><li><a class="site-page child" href="/census/"><i class="fa-fw fas fa-chart-area"></i><span> 访问统计</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/top/"><i class="fa-fw fab fa-hotjar"></i><span> 阅读排行榜</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 娱乐</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Doraemonzzz</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-chart-pie"></i><span> 博客统计</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/charts/"><i class="fa-fw far fa-chart-bar"></i><span> 文章统计</span></a></li><li><a class="site-page child" href="/census/"><i class="fa-fw fas fa-chart-area"></i><span> 访问统计</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/top/"><i class="fa-fw fab fa-hotjar"></i><span> 阅读排行榜</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 娱乐</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Stanford Compiler PA3</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-04-24T10:24:00.000Z" title="发表于 2021-04-24 18:24:00">2021-04-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-04-24T14:18:59.147Z" title="更新于 2021-04-24 22:18:59">2021-04-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/">编译原理</a></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E6%96%AF%E5%9D%A6%E7%A6%8F%E5%A4%A7%E5%AD%A6%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/">斯坦福大学编译原理</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>12分钟</span></span><span class="post-meta-separator">|</span><span class="leancloud_visitors" id="/2021/04/24/2021-4-24-Stanford-Compiler-PA3/" data-flag-title="Stanford Compiler PA3"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span class="leancloud-visitors-count"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2021/04/24/2021-4-24-Stanford-Compiler-PA3/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2021/04/24/2021-4-24-Stanford-Compiler-PA3/" itemprop="commentCount"></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>课程主页：</p>
<p><a target="_blank" rel="noopener" href="https://www.edx.org/course/compilers">https://www.edx.org/course/compilers</a></p>
<p>课程视频：</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1NE411376V?p=20&amp;t=6">https://www.bilibili.com/video/BV1NE411376V?p=20&amp;t=6</a></p>
<p>参考资料：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/dychen/compilers/tree/master/PA3">https://github.com/dychen/compilers/tree/master/PA3</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/yifanyang96/Compiler/tree/master/PA3">https://github.com/yifanyang96/Compiler/tree/master/PA3</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/skyzluo/CS143-Compilers-Stanford">https://github.com/skyzluo/CS143-Compilers-Stanford</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/afterthat97/cool-compiler">https://github.com/afterthat97/cool-compiler</a></p>
<p>error处理：</p>
<p><a target="_blank" rel="noopener" href="http://marvin.cs.uidaho.edu/Teaching/CS445/bisonErrorToken.html">http://marvin.cs.uidaho.edu/Teaching/CS445/bisonErrorToken.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.gnu.org/software/bison/manual/html_node/Error-Recovery.html">https://www.gnu.org/software/bison/manual/html_node/Error-Recovery.html</a></p>
<p>这次回顾作业3——语法分析，本次作业和前一次相比要容易一些，困难的部分主要是错误处理，主要参考了第一份资料。</p>
<span id="more"></span>
<h2 id="作业分析"><a href="#作业分析" class="headerlink" title="作业分析"></a>作业分析</h2><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><p>完成本次作业的整体流程如下：</p>
<ol>
<li><p>阅读如下内容：</p>
<ol>
<li>PA3。</li>
<li>cool-manual第16页的运算符优先级，第17页的上下文无关文法。</li>
<li>cool-tour第6章。</li>
<li>bison介绍：<ol>
<li>flex与bison第3章（重点推荐）。</li>
<li><a target="_blank" rel="noopener" href="http://westes.github.io/flex/manual/">http://westes.github.io/flex/manual/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.gnu.org/software/bison/manual/bison.html">https://www.gnu.org/software/bison/manual/bison.html</a></li>
</ol>
</li>
<li>cool-parse.h，stringtab.h，stringtab_functions.h</li>
</ol>
</li>
<li><p>编写cool.y</p>
</li>
<li><p>下载评分脚本：</p>
<pre class="line-numbers language-none"><code class="language-none">wget https:&#x2F;&#x2F;courses.edx.org&#x2F;asset-v1:StanfordOnline+SOE.YCSCS1+1T2020+type@asset+block@pa2-grading.pl<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>编译：</p>
<pre class="line-numbers language-none"><code class="language-none">make -f Makefile
make parser<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>测试：</p>
<pre class="line-numbers language-none"><code class="language-none">perl pa2-grading.pl<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
</ol>
<h3 id="上下文无关文法"><a href="#上下文无关文法" class="headerlink" title="上下文无关文法"></a>上下文无关文法</h3><p>本次作业主要参考上下文无关文法编写：</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://github.com/Doraemonzzz/md-photo/blob/master/Compiler/PA3/2021042401.jpg?raw=true" alt=""></p>
<p>代码中写明了对应的非终结符关系：</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/*
*  cool.y
*              Parser definition for the COOL language.
*
*/</span>
<span class="token operator">%</span><span class="token punctuation">&#123;</span>
  <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>
  <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"cool-tree.h"</span></span>
  <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stringtab.h"</span></span>
  <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"utilities.h"</span></span>
  
  <span class="token keyword">extern</span> <span class="token keyword">char</span> <span class="token operator">*</span>curr_filename<span class="token punctuation">;</span>
  
  
  <span class="token comment">/* Locations */</span>
  <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">YYLTYPE</span> <span class="token expression"><span class="token keyword">int</span>              </span><span class="token comment">/* the type of locations */</span></span>
  <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">cool_yylloc</span> <span class="token expression">curr_lineno  </span><span class="token comment">/* use the curr_lineno from the lexer for the location of tokens */</span></span>
    
    <span class="token keyword">extern</span> <span class="token keyword">int</span> node_lineno<span class="token punctuation">;</span>          <span class="token comment">/* set before constructing a tree node
    to whatever you want the line number
    for the tree node to be */</span>
      
      
      <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">YYLLOC_DEFAULT</span><span class="token expression"><span class="token punctuation">(</span>Current<span class="token punctuation">,</span> Rhs<span class="token punctuation">,</span> N<span class="token punctuation">)</span>         </span><span class="token punctuation">\</span>
      <span class="token expression">Current <span class="token operator">=</span> Rhs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                             </span><span class="token punctuation">\</span>
      <span class="token expression">node_lineno <span class="token operator">=</span> Current<span class="token punctuation">;</span></span></span>
    
    
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">SET_NODELOC</span><span class="token expression"><span class="token punctuation">(</span>Current<span class="token punctuation">)</span>  </span><span class="token punctuation">\</span>
    <span class="token expression">node_lineno <span class="token operator">=</span> Current<span class="token punctuation">;</span></span></span>
    
    <span class="token comment">/* IMPORTANT NOTE ON LINE NUMBERS
    *********************************
    * The above definitions and macros cause every terminal in your grammar to 
    * have the line number supplied by the lexer. The only task you have to
    * implement for line numbers to work correctly, is to use SET_NODELOC()
    * before constructing any constructs from non-terminals in your grammar.
    * Example: Consider you are matching on the following very restrictive 
    * (fictional) construct that matches a plus between two integer constants. 
    * (SUCH A RULE SHOULD NOT BE  PART OF YOUR PARSER):
    
    plus_consts	: INT_CONST '+' INT_CONST 
    
    * where INT_CONST is a terminal for an integer constant. Now, a correct
    * action for this rule that attaches the correct line number to plus_const
    * would look like the following:
    
    plus_consts	: INT_CONST '+' INT_CONST 
    &#123;
      // Set the line number of the current non-terminal:
      // ***********************************************
      // You can access the line numbers of the i'th item with @i, just
      // like you acess the value of the i'th exporession with $i.
      //
      // Here, we choose the line number of the last INT_CONST (@3) as the
      // line number of the resulting expression (@$). You are free to pick
      // any reasonable line as the line number of non-terminals. If you 
      // omit the statement @$=..., bison has default rules for deciding which 
      // line number to use. Check the manual for details if you are interested.
      @$ = @3;
      
      
      // Observe that we call SET_NODELOC(@3); this will set the global variable
      // node_lineno to @3. Since the constructor call "plus" uses the value of 
      // this global, the plus node will now have the correct line number.
      SET_NODELOC(@3);
      
      // construct the result node:
      $$ = plus(int_const($1), int_const($3));
    &#125;
    
    */</span>
    
    
    
    <span class="token keyword">void</span> <span class="token function">yyerror</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/*  defined below; called for each parse error */</span>
    <span class="token keyword">extern</span> <span class="token keyword">int</span> <span class="token function">yylex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">/*  the entry point to the lexer  */</span>
    
    <span class="token comment">/************************************************************************/</span>
    <span class="token comment">/*                DONT CHANGE ANYTHING IN THIS SECTION                  */</span>
    
    Program ast_root<span class="token punctuation">;</span>	      <span class="token comment">/* the result of the parse  */</span>
    Classes parse_results<span class="token punctuation">;</span>        <span class="token comment">/* for use in semantic analysis */</span>
    <span class="token keyword">int</span> omerrs <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>               <span class="token comment">/* number of errors in lexing and parsing */</span>
    <span class="token operator">%</span><span class="token punctuation">&#125;</span>
    
    <span class="token comment">/* A union of all the types that can be the result of parsing actions. */</span>
    <span class="token operator">%</span><span class="token keyword">union</span> <span class="token punctuation">&#123;</span>
      Boolean boolean<span class="token punctuation">;</span>
      Symbol symbol<span class="token punctuation">;</span>
      Program program<span class="token punctuation">;</span>
      Class_ class_<span class="token punctuation">;</span>
      Classes classes<span class="token punctuation">;</span>
      Feature feature<span class="token punctuation">;</span>
      Features features<span class="token punctuation">;</span>
      Formal formal<span class="token punctuation">;</span>
      Formals formals<span class="token punctuation">;</span>
      Case case_<span class="token punctuation">;</span>
      Cases cases<span class="token punctuation">;</span>
      Expression expression<span class="token punctuation">;</span>
      Expressions expressions<span class="token punctuation">;</span>
      <span class="token keyword">char</span> <span class="token operator">*</span>error_msg<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">/* 
    Declare the terminals; a few have types for associated lexemes.
    The token ERROR is never used in the parser; thus, it is a parse
    error when the lexer returns it.
    
    The integer following token declaration is the numeric constant used
    to represent that token internally.  Typically, Bison generates these
    on its own, but we give explicit numbers to prevent version parity
    problems (bison 1.25 and earlier start at 258, later versions -- at
    257)
    */</span>
    <span class="token operator">%</span>token CLASS <span class="token number">258</span> ELSE <span class="token number">259</span> FI <span class="token number">260</span> IF <span class="token number">261</span> IN <span class="token number">262</span> 
    <span class="token operator">%</span>token INHERITS <span class="token number">263</span> LET <span class="token number">264</span> LOOP <span class="token number">265</span> POOL <span class="token number">266</span> THEN <span class="token number">267</span> WHILE <span class="token number">268</span>
    <span class="token operator">%</span>token CASE <span class="token number">269</span> ESAC <span class="token number">270</span> OF <span class="token number">271</span> DARROW <span class="token number">272</span> NEW <span class="token number">273</span> ISVOID <span class="token number">274</span>
    <span class="token operator">%</span>token <span class="token operator">&lt;</span>symbol<span class="token operator">></span>  STR_CONST <span class="token number">275</span> INT_CONST <span class="token number">276</span> 
    <span class="token operator">%</span>token <span class="token operator">&lt;</span>boolean<span class="token operator">></span> BOOL_CONST <span class="token number">277</span>
    <span class="token operator">%</span>token <span class="token operator">&lt;</span>symbol<span class="token operator">></span>  TYPEID <span class="token number">278</span> OBJECTID <span class="token number">279</span> 
    <span class="token operator">%</span>token ASSIGN <span class="token number">280</span> NOT <span class="token number">281</span> LE <span class="token number">282</span> ERROR <span class="token number">283</span>
    
    <span class="token comment">/*  DON'T CHANGE ANYTHING ABOVE THIS LINE, OR YOUR PARSER WONT WORK       */</span>
    <span class="token comment">/**************************************************************************/</span>
    
    <span class="token comment">/* Complete the nonterminal list below, giving a type for the semantic
    value of each non terminal. (See section 3.6 in the bison 
    documentation for details). */</span>
    
    <span class="token comment">/* Declare types for the grammar's non-terminals. */</span>
    <span class="token operator">%</span>type <span class="token operator">&lt;</span>program<span class="token operator">></span> program
    <span class="token operator">%</span>type <span class="token operator">&lt;</span>classes<span class="token operator">></span> class_list
    <span class="token operator">%</span>type <span class="token operator">&lt;</span>class_<span class="token operator">></span> <span class="token keyword">class</span>
    
    <span class="token comment">/* You will want to change the following line. */</span>
    <span class="token operator">%</span>type <span class="token operator">&lt;</span>feature<span class="token operator">></span> feature
    <span class="token operator">%</span>type <span class="token operator">&lt;</span>features<span class="token operator">></span> feature_list
    <span class="token operator">%</span>type <span class="token operator">&lt;</span>formal<span class="token operator">></span> formal
    <span class="token operator">%</span>type <span class="token operator">&lt;</span>formals<span class="token operator">></span> formal_list   
    <span class="token operator">%</span>type <span class="token operator">&lt;</span>case_<span class="token operator">></span> branch
    <span class="token operator">%</span>type <span class="token operator">&lt;</span>cases<span class="token operator">></span> branch_list
    <span class="token operator">%</span>type <span class="token operator">&lt;</span>expression<span class="token operator">></span> expr
    <span class="token operator">%</span>type <span class="token operator">&lt;</span>expression<span class="token operator">></span> <span class="token keyword">while</span>
    <span class="token operator">%</span>type <span class="token operator">&lt;</span>expression<span class="token operator">></span> let
    <span class="token operator">%</span>type <span class="token operator">&lt;</span>expressions<span class="token operator">></span> expr_list
    <span class="token operator">%</span>type <span class="token operator">&lt;</span>expressions<span class="token operator">></span> expr_list_
    
    <span class="token comment">/* Precedence declarations go here. */</span>
    <span class="token operator">%</span>right ASSIGN
    <span class="token operator">%</span>left NOT
    <span class="token operator">%</span>nonassoc LE <span class="token string">'&lt;'</span> <span class="token string">'='</span>
    <span class="token operator">%</span>left <span class="token string">'+'</span> <span class="token string">'-'</span>
    <span class="token operator">%</span>left <span class="token string">'*'</span> <span class="token string">'/'</span>
    <span class="token operator">%</span>left ISVOID
    <span class="token operator">%</span>left <span class="token string">'~'</span>
    <span class="token operator">%</span>left <span class="token string">'@'</span>
    <span class="token operator">%</span>left <span class="token string">'.'</span>

    <span class="token operator">%</span><span class="token operator">%</span>
    <span class="token comment">/* 
    Save the root of the abstract syntax tree in a global variable.
    */</span>
    program	
      <span class="token operator">:</span> class_list	
        <span class="token punctuation">&#123;</span> @$ <span class="token operator">=</span> @<span class="token number">1</span><span class="token punctuation">;</span>
          ast_root <span class="token operator">=</span> <span class="token function">program</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    <span class="token comment">/* [[class;]]+ */</span>
    class_list
      <span class="token operator">:</span> <span class="token keyword">class</span>			<span class="token comment">/* single class */</span>
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">single_Classes</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          parse_results <span class="token operator">=</span> $$<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
      <span class="token operator">|</span> class_list <span class="token keyword">class</span>	<span class="token comment">/* several classes */</span>
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">append_Classes</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span><span class="token function">single_Classes</span><span class="token punctuation">(</span>$<span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
          parse_results <span class="token operator">=</span> $$<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    <span class="token comment">/* If no parent is specified, the class inherits from the Object class. */</span>
    <span class="token comment">//* class; */</span>
    <span class="token keyword">class</span>
      <span class="token operator">:</span> CLASS TYPEID <span class="token string">'&#123;'</span> feature_list <span class="token string">'&#125;'</span> <span class="token string">';'</span>
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">class_</span><span class="token punctuation">(</span>$<span class="token number">2</span><span class="token punctuation">,</span>idtable<span class="token punctuation">.</span><span class="token function">add_string</span><span class="token punctuation">(</span><span class="token string">"Object"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>$<span class="token number">4</span><span class="token punctuation">,</span>
          stringtable<span class="token punctuation">.</span><span class="token function">add_string</span><span class="token punctuation">(</span>curr_filename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
      <span class="token operator">|</span> CLASS TYPEID INHERITS TYPEID <span class="token string">'&#123;'</span> feature_list <span class="token string">'&#125;'</span> <span class="token string">';'</span>
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">class_</span><span class="token punctuation">(</span>$<span class="token number">2</span><span class="token punctuation">,</span>$<span class="token number">4</span><span class="token punctuation">,</span>$<span class="token number">6</span><span class="token punctuation">,</span>stringtable<span class="token punctuation">.</span><span class="token function">add_string</span><span class="token punctuation">(</span>curr_filename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
      <span class="token operator">|</span> CLASS error <span class="token string">';'</span> <span class="token keyword">class</span> 
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> $<span class="token number">4</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    
    <span class="token comment">/* Feature list may be empty, but no empty features in list. */</span>
    <span class="token comment">/* [[feature;]]* */</span>
    feature_list
      <span class="token operator">:</span>		<span class="token comment">/* empty */</span>
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">nil_Features</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
      <span class="token operator">|</span> feature_list feature
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">append_Features</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">single_Features</span><span class="token punctuation">(</span>$<span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token operator">|</span> feature_list error <span class="token string">';'</span>
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> $<span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

    <span class="token comment">/* feature; */</span>
    feature
      <span class="token operator">:</span> OBJECTID <span class="token string">'('</span> <span class="token string">')'</span> <span class="token string">':'</span> TYPEID <span class="token string">'&#123;'</span> expr <span class="token string">'&#125;'</span> <span class="token string">';'</span>
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">method</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">nil_Formals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> $<span class="token number">5</span><span class="token punctuation">,</span> $<span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
      <span class="token operator">|</span> OBJECTID <span class="token string">'('</span> formal_list <span class="token string">')'</span> <span class="token string">':'</span> TYPEID <span class="token string">'&#123;'</span> expr <span class="token string">'&#125;'</span> <span class="token string">';'</span>
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">method</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">,</span> $<span class="token number">6</span><span class="token punctuation">,</span> $<span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
      <span class="token operator">|</span> OBJECTID <span class="token string">':'</span> TYPEID <span class="token string">';'</span>
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">attr</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">,</span> <span class="token function">no_expr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
      <span class="token operator">|</span> OBJECTID <span class="token string">':'</span> TYPEID ASSIGN expr <span class="token string">';'</span>
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">attr</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">,</span> $<span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> 

    <span class="token comment">/* formal */</span>
    formal
      <span class="token operator">:</span> OBJECTID <span class="token string">':'</span> TYPEID
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">formal</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    <span class="token comment">/* [formal [[, formal]]* */</span>
    formal_list
      <span class="token operator">:</span> formal
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">single_Formals</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
      <span class="token operator">|</span> formal_list <span class="token string">','</span> formal
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">append_Formals</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">single_Formals</span><span class="token punctuation">(</span>$<span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token comment">/* expr [[, expr]]* */</span>
    expr_list
      <span class="token operator">:</span> expr
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">single_Expressions</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
      <span class="token operator">|</span> expr_list <span class="token string">','</span> expr
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">append_Expressions</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">single_Expressions</span><span class="token punctuation">(</span>$<span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token comment">/* [[expr;]]+ */</span>
    expr_list_
      <span class="token operator">:</span> expr <span class="token string">';'</span>
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">single_Expressions</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
      <span class="token operator">|</span> expr_list_  expr <span class="token string">';'</span>
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">append_Expressions</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">single_Expressions</span><span class="token punctuation">(</span>$<span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token operator">|</span> expr_list_ error <span class="token string">';'</span> 
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> $<span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>      

    <span class="token comment">/* ID : TYPE [ &lt;- expr ] [[, ID : TYPE [ &lt;- expr ]]]* in expr */</span>
    let
      <span class="token operator">:</span> OBJECTID <span class="token string">':'</span> TYPEID IN expr
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">let</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">,</span> <span class="token function">no_expr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> $<span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
      <span class="token operator">|</span> OBJECTID <span class="token string">':'</span> TYPEID ASSIGN expr IN expr
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">let</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">,</span> $<span class="token number">5</span><span class="token punctuation">,</span> $<span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
      <span class="token operator">|</span> OBJECTID <span class="token string">':'</span> TYPEID <span class="token string">','</span> let
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">let</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">,</span> <span class="token function">no_expr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> $<span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
      <span class="token operator">|</span> OBJECTID <span class="token string">':'</span> TYPEID ASSIGN expr <span class="token string">','</span> let
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">let</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">,</span> $<span class="token number">5</span><span class="token punctuation">,</span> $<span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token operator">|</span> error <span class="token string">','</span> let
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> $<span class="token number">3</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

    <span class="token comment">/* ID : TYPE => expr; */</span>
    branch
      <span class="token operator">:</span> OBJECTID <span class="token string">':'</span> TYPEID DARROW expr <span class="token string">';'</span>
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">branch</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">,</span> $<span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token comment">/* [[ID : TYPE => expr;]]+ */</span>
    branch_list
      <span class="token operator">:</span> branch
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">single_Cases</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
      <span class="token operator">|</span> branch_list branch 
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">append_Cases</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">single_Cases</span><span class="token punctuation">(</span>$<span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token comment">/* nonempty expr  */</span>
    expr
      <span class="token comment">// assign</span>
      <span class="token operator">:</span> OBJECTID ASSIGN expr
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">assign</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token comment">// expr[@TYPE]:ID( [ expr [[; expr]]* ] )</span>
      <span class="token comment">// dispath</span>
      <span class="token operator">|</span> expr <span class="token string">'.'</span> OBJECTID <span class="token string">'('</span> <span class="token string">')'</span>
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">,</span> <span class="token function">nil_Expressions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
      <span class="token operator">|</span> expr <span class="token string">'.'</span> OBJECTID <span class="token string">'('</span> expr_list <span class="token string">')'</span>
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">,</span> $<span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
      <span class="token comment">// static dispatch</span>
      <span class="token operator">|</span> expr <span class="token string">'@'</span> TYPEID <span class="token string">'.'</span> OBJECTID <span class="token string">'('</span> <span class="token string">')'</span>
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">static_dispatch</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">,</span> $<span class="token number">5</span><span class="token punctuation">,</span> <span class="token function">nil_Expressions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
      <span class="token operator">|</span> expr <span class="token string">'@'</span> TYPEID <span class="token string">'.'</span> OBJECTID <span class="token string">'('</span> expr_list <span class="token string">')'</span>
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">static_dispatch</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">,</span> $<span class="token number">5</span><span class="token punctuation">,</span> $<span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token comment">// ID( [ expr [[; expr]]* ] )</span>
      <span class="token operator">|</span> OBJECTID <span class="token string">'('</span> <span class="token string">')'</span>
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">object</span><span class="token punctuation">(</span>idtable<span class="token punctuation">.</span><span class="token function">add_string</span><span class="token punctuation">(</span><span class="token string">"self"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> $<span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">nil_Expressions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
      <span class="token operator">|</span> OBJECTID <span class="token string">'('</span> expr_list <span class="token string">')'</span>
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">object</span><span class="token punctuation">(</span>idtable<span class="token punctuation">.</span><span class="token function">add_string</span><span class="token punctuation">(</span><span class="token string">"self"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> $<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token comment">// if expr then expr else expr fi</span>
      <span class="token operator">|</span> IF expr THEN expr ELSE expr FI
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">cond</span><span class="token punctuation">(</span>$<span class="token number">2</span><span class="token punctuation">,</span> $<span class="token number">4</span><span class="token punctuation">,</span> $<span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token comment">// while expr loop expr pool</span>
      <span class="token operator">|</span> WHILE expr LOOP expr POOL
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">loop</span><span class="token punctuation">(</span>$<span class="token number">2</span><span class="token punctuation">,</span> $<span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token comment">// &#123; [[expr; ]]+ &#125;</span>
      <span class="token operator">|</span> <span class="token string">'&#123;'</span> expr_list_ <span class="token string">'&#125;'</span>
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">block</span><span class="token punctuation">(</span>$<span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token comment">// let ID : TYPE [ &lt;- expr ] [[; ID : TYPE [ &lt;- expr ]]]* in expr</span>
      <span class="token operator">|</span> LET let
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> $<span class="token number">2</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token comment">// case expr of [[ID : TYPE => expr; ]]+ esac</span>
      <span class="token operator">|</span> CASE expr OF branch_list ESAC
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">typcase</span><span class="token punctuation">(</span>$<span class="token number">2</span><span class="token punctuation">,</span> $<span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token comment">// new TYPE</span>
      <span class="token operator">|</span> NEW TYPEID
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">new_</span><span class="token punctuation">(</span>$<span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token comment">// isvoid expr</span>
      <span class="token operator">|</span> ISVOID expr
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">isvoid</span><span class="token punctuation">(</span>$<span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token comment">// expr + expr</span>
      <span class="token operator">|</span> expr <span class="token string">'+'</span> expr
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">plus</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token comment">// expr - expr</span>
      <span class="token operator">|</span> expr <span class="token string">'-'</span> expr
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">sub</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token comment">// expr * expr</span>
      <span class="token operator">|</span> expr <span class="token string">'*'</span> expr
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">mul</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token comment">// expr / expr</span>
      <span class="token operator">|</span> expr <span class="token string">'/'</span> expr
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">divide</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token comment">// ~expr</span>
      <span class="token operator">|</span> <span class="token string">'~'</span> expr
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">neg</span><span class="token punctuation">(</span>$<span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token comment">// expr &lt; expr</span>
      <span class="token operator">|</span> expr <span class="token string">'&lt;'</span> expr
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">lt</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token comment">// expr &lt;= expr</span>
      <span class="token operator">|</span> expr LE expr
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">leq</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token comment">// expr = expr</span>
      <span class="token operator">|</span> expr <span class="token string">'='</span> expr
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">eq</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token comment">// not expr</span>
      <span class="token operator">|</span> NOT expr
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">comp</span><span class="token punctuation">(</span>$<span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token comment">// (expr)</span>
      <span class="token operator">|</span> <span class="token string">'('</span> expr <span class="token string">')'</span>
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> $<span class="token number">2</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token comment">// ID</span>
      <span class="token operator">|</span> OBJECTID
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">object</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token comment">// integer</span>
      <span class="token operator">|</span> INT_CONST
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">int_const</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token comment">// string</span>
      <span class="token operator">|</span> STR_CONST
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">string_const</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token comment">// true, false</span>
      <span class="token operator">|</span> BOOL_CONST
        <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">bool_const</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    
    <span class="token comment">/* end of grammar */</span>
    <span class="token operator">%</span><span class="token operator">%</span>
    
    <span class="token comment">/* This function is called automatically when Bison detects a parse error. */</span>
    <span class="token keyword">void</span> <span class="token function">yyerror</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token keyword">extern</span> <span class="token keyword">int</span> curr_lineno<span class="token punctuation">;</span>
      
      cerr <span class="token operator">&lt;&lt;</span> <span class="token string">"\""</span> <span class="token operator">&lt;&lt;</span> curr_filename <span class="token operator">&lt;&lt;</span> <span class="token string">"\", line "</span> <span class="token operator">&lt;&lt;</span> curr_lineno <span class="token operator">&lt;&lt;</span> <span class="token string">": "</span> \
      <span class="token operator">&lt;&lt;</span> s <span class="token operator">&lt;&lt;</span> <span class="token string">" at or near "</span><span class="token punctuation">;</span>
      <span class="token function">print_cool_token</span><span class="token punctuation">(</span>yychar<span class="token punctuation">)</span><span class="token punctuation">;</span>
      cerr <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
      omerrs<span class="token operator">++</span><span class="token punctuation">;</span>
      
      <span class="token keyword">if</span><span class="token punctuation">(</span>omerrs<span class="token operator">></span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token string">"More than 50 errors\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="优先级申明"><a href="#优先级申明" class="headerlink" title="优先级申明"></a>优先级申明</h3><p>下表给出了从最高到最低的中缀二元运算和前缀一元运算的优先级：</p>
<pre class="line-numbers language-none"><code class="language-none">.
@
~
isvoid
* &#x2F;
+ -
&lt;&#x3D; &lt; &#x3D;
not
&lt;-<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>所有二元运算都是左结合的，除了赋值是右结合的，还有三个比较运算是没有结合性的。</p>
<p>据此给出代码中的运算符优先级，注意bison中优先级是从低到高排列：</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;* Precedence declarations go here. *&#x2F;
%right ASSIGN
%left NOT
%nonassoc LE &#39;&lt;&#39; &#39;&#x3D;&#39;
%left &#39;+&#39; &#39;-&#39;
%left &#39;*&#39; &#39;&#x2F;&#39;
%left ISVOID
%left &#39;~&#39;
%left &#39;@&#39;
%left &#39;.&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><p>完成之前可以先阅读：</p>
<p><a target="_blank" rel="noopener" href="http://marvin.cs.uidaho.edu/Teaching/CS445/bisonErrorToken.html">http://marvin.cs.uidaho.edu/Teaching/CS445/bisonErrorToken.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.gnu.org/software/bison/manual/html_node/Error-Recovery.html">https://www.gnu.org/software/bison/manual/html_node/Error-Recovery.html</a></p>
<p>这部分是这次作业的难点，主要是根据PA2的错误处理部分：</p>
<ul>
<li>如果类定义中有错误，但该类正确终止，并且下一个类的语法正确，则解析器应该能够在下一个类定义时重新启动。</li>
<li>类似地，解析器应该从feature（继续到下一个feature）、let绑定（继续到下一个变量）和$\{\ldots \}$块中的表达式中的错误中恢复。</li>
</ul>
<p>这两部分对应如下三种含义：</p>
<ul>
<li>如果处理class时报错，应该忽略该错误，然后处理后续的class。</li>
<li>如果处理feature时报错，则忽略该错误，然后处理后续的feature。</li>
<li>如果处理let时报错，则忽略该错误，然后处理后续的let。</li>
</ul>
<p>对应的代码：</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span>
  <span class="token operator">:</span> CLASS TYPEID <span class="token string">'&#123;'</span> feature_list <span class="token string">'&#125;'</span> <span class="token string">';'</span>
    <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">class_</span><span class="token punctuation">(</span>$<span class="token number">2</span><span class="token punctuation">,</span>idtable<span class="token punctuation">.</span><span class="token function">add_string</span><span class="token punctuation">(</span><span class="token string">"Object"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>$<span class="token number">4</span><span class="token punctuation">,</span>
      stringtable<span class="token punctuation">.</span><span class="token function">add_string</span><span class="token punctuation">(</span>curr_filename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
  <span class="token operator">|</span> CLASS TYPEID INHERITS TYPEID <span class="token string">'&#123;'</span> feature_list <span class="token string">'&#125;'</span> <span class="token string">';'</span>
    <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">class_</span><span class="token punctuation">(</span>$<span class="token number">2</span><span class="token punctuation">,</span>$<span class="token number">4</span><span class="token punctuation">,</span>$<span class="token number">6</span><span class="token punctuation">,</span>stringtable<span class="token punctuation">.</span><span class="token function">add_string</span><span class="token punctuation">(</span>curr_filename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
  <span class="token operator">|</span> CLASS error <span class="token string">';'</span> <span class="token keyword">class</span> 
    <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> $<span class="token number">4</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    
feature_list
  <span class="token operator">:</span>		<span class="token comment">/* empty */</span>
    <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">nil_Features</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
  <span class="token operator">|</span> feature_list feature
    <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">append_Features</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">single_Features</span><span class="token punctuation">(</span>$<span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token operator">|</span> feature_list error <span class="token string">';'</span>
    <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> $<span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    
let
  <span class="token operator">:</span> OBJECTID <span class="token string">':'</span> TYPEID IN expr
    <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">let</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">,</span> <span class="token function">no_expr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> $<span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
  <span class="token operator">|</span> OBJECTID <span class="token string">':'</span> TYPEID ASSIGN expr IN expr
    <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">let</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">,</span> $<span class="token number">5</span><span class="token punctuation">,</span> $<span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
  <span class="token operator">|</span> OBJECTID <span class="token string">':'</span> TYPEID <span class="token string">','</span> let
    <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">let</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">,</span> <span class="token function">no_expr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> $<span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
  <span class="token operator">|</span> OBJECTID <span class="token string">':'</span> TYPEID ASSIGN expr <span class="token string">','</span> let
    <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> <span class="token function">let</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">3</span><span class="token punctuation">,</span> $<span class="token number">5</span><span class="token punctuation">,</span> $<span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token operator">|</span> error <span class="token string">','</span> let
    <span class="token punctuation">&#123;</span> $$ <span class="token operator">=</span> $<span class="token number">3</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h3><pre class="line-numbers language-none"><code class="language-none">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
submission: ..

&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
You got a score of 70 out of 70.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Doraemonzzz</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://www.doraemonzzz.com/2021/04/24/2021-4-24-Stanford-Compiler-PA3/">http://www.doraemonzzz.com/2021/04/24/2021-4-24-Stanford-Compiler-PA3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://www.doraemonzzz.com" target="_blank">Doraemonzzz</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%96%AF%E5%9D%A6%E7%A6%8F%E5%A4%A7%E5%AD%A6%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/">斯坦福大学编译原理</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/04/24/2021-4-24-%E6%9C%AA%E5%AE%8C%E6%88%90%E7%9A%84%E8%AF%BE%E7%A8%8B%E6%B1%87%E6%80%BB/"><img class="prev-cover" src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">未完成的课程汇总</div></div></a></div><div class="next-post pull-right"><a href="/2021/04/24/2021-4-24-Stanford-Compiler-PA3%E7%BF%BB%E8%AF%91/"><img class="next-cover" src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Stanford Compiler PA3翻译</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/04/15/2021-4-15-Stanford-Compiler-Week-5-Cool-Type-Checking/" title="Stanford Compiler Week 5 Cool Type Checking"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-15</div><div class="title">Stanford Compiler Week 5 Cool Type Checking</div></div></a></div><div><a href="/2021/04/20/2021-4-20-Stanford-Compiler-实验环境配置（续）/" title="Stanford Compiler 实验环境配置（续）"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-20</div><div class="title">Stanford Compiler 实验环境配置（续）</div></div></a></div><div><a href="/2021/04/24/2021-4-24-Stanford-Compiler-PA3翻译/" title="Stanford Compiler PA3翻译"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-24</div><div class="title">Stanford Compiler PA3翻译</div></div></a></div><div><a href="/2021/04/24/2021-4-24-Stanford-Compiler-Week-6-Runtime-Organization/" title="Stanford Compiler Week 6 Runtime Organization"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-24</div><div class="title">Stanford Compiler Week 6 Runtime Organization</div></div></a></div><div><a href="/2021/04/24/2021-4-24-Stanford-Compiler-Week-6-Code-Generation-Part-1/" title="Stanford Compiler Week 6 Code Generation Part 1"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-24</div><div class="title">Stanford Compiler Week 6 Code Generation Part 1</div></div></a></div><div><a href="/2021/04/26/2021-4-26-Stanford-Compiler-Week-6-Code-Generation-Part-2/" title="Stanford Compiler Week 6 Code Generation Part 2"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-26</div><div class="title">Stanford Compiler Week 6 Code Generation Part 2</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Livere</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="lv-container" data-id="city" data-uid="MTAyMC8zNDcxOS8xMTI1Ng=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src= "/img/loading.gif" data-lazy-src="https://github.com/Doraemonzzz/md-photo/blob/master/%E5%A4%B4%E5%83%8F.jpg?raw=true" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Doraemonzzz</div><div class="author-info__description">个人博客，主要记录有关机器学习，数学以及计算机科学的笔记</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">786</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">79</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">32</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Doraemonzzz"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Doraemonzzz" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/doraemon_zzz@163.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://space.bilibili.com/291079982" target="_blank" title="Bilibili"><i class="iconfont icon-bilibili"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title=""><i class="fa fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">暂无公告</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A%E5%88%86%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">作业分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">1.1.</span> <span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E4%B8%8B%E6%96%87%E6%97%A0%E5%85%B3%E6%96%87%E6%B3%95"><span class="toc-number">1.2.</span> <span class="toc-text">上下文无关文法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%85%88%E7%BA%A7%E7%94%B3%E6%98%8E"><span class="toc-number">1.3.</span> <span class="toc-text">优先级申明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">1.4.</span> <span class="toc-text">错误处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C"><span class="toc-number">1.5.</span> <span class="toc-text">运行结果</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/01/06/2023-1-6-ECE408-Lecture-6-Generalized-Tiling-and-DRAM-Bandwidth/" title="ECE408 Lecture 6 Generalized Tiling and DRAM Bandwidth"><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ECE408 Lecture 6 Generalized Tiling and DRAM Bandwidth"/></a><div class="content"><a class="title" href="/2023/01/06/2023-1-6-ECE408-Lecture-6-Generalized-Tiling-and-DRAM-Bandwidth/" title="ECE408 Lecture 6 Generalized Tiling and DRAM Bandwidth">ECE408 Lecture 6 Generalized Tiling and DRAM Bandwidth</a><time datetime="2023-01-06T06:30:00.000Z" title="发表于 2023-01-06 14:30:00">2023-01-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/01/06/2023-1-6-ECE408-Lecture-4-CUDA-Memory-Model/" title="ECE408 Lecture 4 CUDA Memory Model"><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ECE408 Lecture 4 CUDA Memory Model"/></a><div class="content"><a class="title" href="/2023/01/06/2023-1-6-ECE408-Lecture-4-CUDA-Memory-Model/" title="ECE408 Lecture 4 CUDA Memory Model">ECE408 Lecture 4 CUDA Memory Model</a><time datetime="2023-01-06T03:07:00.000Z" title="发表于 2023-01-06 11:07:00">2023-01-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/01/06/2023-1-6-ECE408-Lecture-5-Locality-and-Tiled-Matrix-Multiply/" title="ECE408 Lecture 5 Locality and Tiled Matrix Multiply"><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ECE408 Lecture 5 Locality and Tiled Matrix Multiply"/></a><div class="content"><a class="title" href="/2023/01/06/2023-1-6-ECE408-Lecture-5-Locality-and-Tiled-Matrix-Multiply/" title="ECE408 Lecture 5 Locality and Tiled Matrix Multiply">ECE408 Lecture 5 Locality and Tiled Matrix Multiply</a><time datetime="2023-01-06T03:07:00.000Z" title="发表于 2023-01-06 11:07:00">2023-01-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/01/05/2023-1-5-ECE408-Lecture-3-CUDA-Parallel-Execution-Model/" title="ECE408 Lecture 3 CUDA Parallel Execution Model"><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ECE408 Lecture 3 CUDA Parallel Execution Model"/></a><div class="content"><a class="title" href="/2023/01/05/2023-1-5-ECE408-Lecture-3-CUDA-Parallel-Execution-Model/" title="ECE408 Lecture 3 CUDA Parallel Execution Model">ECE408 Lecture 3 CUDA Parallel Execution Model</a><time datetime="2023-01-05T09:03:00.000Z" title="发表于 2023-01-05 17:03:00">2023-01-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/01/05/2023-1-5-ECE408-Lecture-2-Introduction-to-Parallel-Computing-and-CUDA/" title="ECE408 Lecture 2 Introduction to Parallel Computing and CUDA"><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ECE408 Lecture 2 Introduction to Parallel Computing and CUDA"/></a><div class="content"><a class="title" href="/2023/01/05/2023-1-5-ECE408-Lecture-2-Introduction-to-Parallel-Computing-and-CUDA/" title="ECE408 Lecture 2 Introduction to Parallel Computing and CUDA">ECE408 Lecture 2 Introduction to Parallel Computing and CUDA</a><time datetime="2023-01-05T03:53:00.000Z" title="发表于 2023-01-05 11:53:00">2023-01-05</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2023 By Doraemonzzz</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.25
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'IpnmxCW9CvYWIXbol5QXsegX-MdYXbMMI',
      appKey: 'w57DVCdbxcyB1TYYagMIMJIU',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: true
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Valine' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>