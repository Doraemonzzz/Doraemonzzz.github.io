<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Unit 4 Trees | Doraemonzzz</title><meta name="keywords" content="The Analytics Edge"><meta name="author" content="Doraemonzzz"><meta name="copyright" content="Doraemonzzz"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="这一周主要介绍了Cart以及randomForest的使用。 课程地址： https:&#x2F;&#x2F;www.edx.org&#x2F;course&#x2F;the-analytics-edge">
<meta property="og:type" content="article">
<meta property="og:title" content="Unit 4 Trees">
<meta property="og:url" content="http://www.doraemonzzz.com/2018/10/22/Unit%204%20Trees/index.html">
<meta property="og:site_name" content="Doraemonzzz">
<meta property="og:description" content="这一周主要介绍了Cart以及randomForest的使用。 课程地址： https:&#x2F;&#x2F;www.edx.org&#x2F;course&#x2F;the-analytics-edge">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2018-10-22T12:30:00.000Z">
<meta property="article:modified_time" content="2018-10-22T12:38:02.000Z">
<meta property="article:author" content="Doraemonzzz">
<meta property="article:tag" content="The Analytics Edge">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="https://github.com/Doraemonzzz/md-photo/blob/master/%E5%A4%B4%E5%83%8F.jpg?raw=true"><link rel="canonical" href="http://www.doraemonzzz.com/2018/10/22/Unit%204%20Trees/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?6f00f37f957f0608abb8c571105456f0";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-G-RE4B1LKRZD"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-G-RE4B1LKRZD');
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"距离上次更新已经","messageNext":"天了，文章内容可能已经过时。"},
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isanchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Unit 4 Trees',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2018-10-22 20:38:02'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><link rel="stylesheet" href="/css/bilibili.css" media="defer" onload="this.media='all'"><meta name="google-site-verification" content="c4v-NmuUZRgl3cvtg9GKswryK1YLaPztd_5M-df5VNI" /><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Doraemonzzz" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src= "/img/loading.gif" data-lazy-src="https://github.com/Doraemonzzz/md-photo/blob/master/%E5%A4%B4%E5%83%8F.jpg?raw=true" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">664</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">68</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">26</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-chart-pie"></i><span> 博客统计</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/charts/"><i class="fa-fw far fa-chart-bar"></i><span> 文章统计</span></a></li><li><a class="site-page child" href="/census/"><i class="fa-fw fas fa-chart-area"></i><span> 访问统计</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/top/"><i class="fa-fw fab fa-hotjar"></i><span> 阅读排行榜</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 娱乐</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Doraemonzzz</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-chart-pie"></i><span> 博客统计</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/charts/"><i class="fa-fw far fa-chart-bar"></i><span> 文章统计</span></a></li><li><a class="site-page child" href="/census/"><i class="fa-fw fas fa-chart-area"></i><span> 访问统计</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/top/"><i class="fa-fw fab fa-hotjar"></i><span> 阅读排行榜</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 娱乐</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Unit 4 Trees</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2018-10-22T12:30:00.000Z" title="发表于 2018-10-22 20:30:00">2018-10-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2018-10-22T12:38:02.000Z" title="更新于 2018-10-22 20:38:02">2018-10-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/R/">R</a></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/The-Analytics-Edge/">The Analytics Edge</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">1.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>6分钟</span></span><span class="post-meta-separator">|</span><span class="leancloud_visitors" id="/2018/10/22/Unit%204%20Trees/" data-flag-title="Unit 4 Trees"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span class="leancloud-visitors-count"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2018/10/22/Unit%204%20Trees/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2018/10/22/Unit%204%20Trees/" itemprop="commentCount"></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>这一周主要介绍了Cart以及randomForest的使用。</p>
<p>课程地址：</p>
<p><a target="_blank" rel="noopener" href="https://www.edx.org/course/the-analytics-edge">https://www.edx.org/course/the-analytics-edge</a></p>
<span id="more"></span>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">setwd(&quot;E:\\The Analytics Edge\\Unit 4 Trees&quot;)
stevens &#x3D; read.csv(&quot;stevens.csv&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>查看数据的结构。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">str(stevens)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>&#39;data.frame&#39;:    566 obs. of  9 variables:
 $ Docket    : Factor w/ 566 levels &quot;00-1011&quot;,&quot;00-1045&quot;,..: 63 69 70 145 97 181 242 289 334 436 ...
 $ Term      : int  1994 1994 1994 1994 1995 1995 1996 1997 1997 1999 ...
 $ Circuit   : Factor w/ 13 levels &quot;10th&quot;,&quot;11th&quot;,..: 4 11 7 3 9 11 13 11 12 2 ...
 $ Issue     : Factor w/ 11 levels &quot;Attorneys&quot;,&quot;CivilRights&quot;,..: 5 5 5 5 9 5 5 5 5 3 ...
 $ Petitioner: Factor w/ 12 levels &quot;AMERICAN.INDIAN&quot;,..: 2 2 2 2 2 2 2 2 2 2 ...
 $ Respondent: Factor w/ 12 levels &quot;AMERICAN.INDIAN&quot;,..: 2 2 2 2 2 2 2 2 2 2 ...
 $ LowerCourt: Factor w/ 2 levels &quot;conser&quot;,&quot;liberal&quot;: 2 2 2 1 1 1 1 1 1 1 ...
 $ Unconst   : int  0 0 0 0 0 1 0 1 0 0 ...
 $ Reverse   : int  1 1 1 1 1 0 1 1 1 1 ...
</code></pre><h4 id="Split-the-data"><a href="#Split-the-data" class="headerlink" title="Split the data"></a>Split the data</h4><p>这里来预测Reverse这个变量，首先划分数据。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(caTools)
set.seed(3000)
spl &#x3D; sample.split(stevens$Reverse, SplitRatio &#x3D; 0.7)
Train &#x3D; subset(stevens, spl&#x3D;&#x3D;TRUE)
Test &#x3D; subset(stevens, spl&#x3D;&#x3D;FALSE)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Install-rpart-library"><a href="#Install-rpart-library" class="headerlink" title="Install rpart library"></a>Install rpart library</h4><p>使用决策树模型只要安装rpart即可，rpart.plot主要是用来展示决策树的结构。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">#install.packages(&quot;rpart&quot;)
library(rpart)
#install.packages(&quot;rpart.plot&quot;)
library(rpart.plot)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="CART-model"><a href="#CART-model" class="headerlink" title="CART model"></a>CART model</h4><p>先来看一个CART的模型：</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://github.com/Doraemonzzz/md-photo/blob/master/The%20Analytics%20Edge/Unit%204/2018102201.png?raw=true" alt=""></p>
<p>CART实际上就是决策树，停止的条件可以由叶节点的数量控制，在R中对应的参数为minbucket。<br>使用CART(Classification and Regression Trees)的方法很简单，如下所示：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">StevensTree &#x3D; rpart(Reverse ~ Circuit + Issue + Petitioner + Respondent + LowerCourt + Unconst, data &#x3D; Train, method&#x3D;&quot;class&quot;, minbucket&#x3D;25)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>注意这里是分类问题，所以method=”class”，如果是回归问题，那么不需要这样设置。<br>prp函数可以查看树的结构。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">prp(StevensTree)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "/img/loading.gif" data-lazy-src="https://github.com/Doraemonzzz/md-photo/blob/master/The%20Analytics%20Edge/Unit%204/output_12_0.png?raw=true" alt="png"></p>
<h4 id="Make-predictions"><a href="#Make-predictions" class="headerlink" title="Make predictions"></a>Make predictions</h4><p>预测数据的方式和之前基本一致，也是使用predict函数：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">PredictCART &#x3D; predict(StevensTree, newdata &#x3D; Test, type &#x3D; &quot;class&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>查看结果。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">table(Test$Reverse, PredictCART)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>   PredictCART
     0  1
  0 41 36
  1 22 71
</code></pre><h4 id="ROC-curve"><a href="#ROC-curve" class="headerlink" title="ROC curve"></a>ROC curve</h4><p>接着来看上一周介绍的ROC曲线。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(ROCR)

PredictROC &#x3D; predict(StevensTree, newdata &#x3D; Test)
pred &#x3D; prediction(PredictROC[,2], Test$Reverse)
perf &#x3D; performance(pred, &quot;tpr&quot;, &quot;fpr&quot;)
plot(perf)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "/img/loading.gif" data-lazy-src="https://github.com/Doraemonzzz/md-photo/blob/master/The%20Analytics%20Edge/Unit%204/output_18_0.png?raw=true" alt="png"></p>
<h4 id="Random-Forest"><a href="#Random-Forest" class="headerlink" title="Random Forest"></a>Random Forest</h4><p>接下来看Random Forest。</p>
<p>Random Forest是一系列决策树组合而成的模型，在R中的使用也很简单。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(randomForest)

# Convert outcome to factor
Train$Reverse &#x3D; as.factor(Train$Reverse)
Test$Reverse &#x3D; as.factor(Test$Reverse)
StevensForest &#x3D; randomForest(Reverse ~ Circuit + Issue + Petitioner + Respondent + LowerCourt + Unconst, data &#x3D; Train, ntree&#x3D;200, nodesize&#x3D;25 )<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ntree是决策树的数量，nodesize就是决策树对应的minbucket参数。</p>
<h4 id="Make-predictions-again"><a href="#Make-predictions-again" class="headerlink" title="Make predictions again"></a>Make predictions again</h4><pre class="line-numbers language-R" data-language="R"><code class="language-R">PredictForest &#x3D; predict(StevensForest, newdata &#x3D; Test)
table(Test$Reverse, PredictForest)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>   PredictForest
     0  1
  0 40 37
  1 18 75
</code></pre><h4 id="cross-validation"><a href="#cross-validation" class="headerlink" title="cross-validation"></a>cross-validation</h4><p>randomForest很容易过拟合，为了防止这种情况，可以增加正则项，正则项有一个对应的系数，R中可以很方便的求出这个系数。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">#install.packages(&quot;caret&quot;)
library(caret)
#install.packages(&quot;e1071&quot;)
library(e1071)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>​    </p>
<h4 id="Define-cross-validation-experiment"><a href="#Define-cross-validation-experiment" class="headerlink" title="Define cross-validation experiment"></a>Define cross-validation experiment</h4><pre class="line-numbers language-R" data-language="R"><code class="language-R">numFolds &#x3D; trainControl( method &#x3D; &quot;cv&quot;, number &#x3D; 10 )
cpGrid &#x3D; expand.grid( .cp &#x3D; seq(0.01,0.5,0.01)) <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="Perform-the-cross-validation"><a href="#Perform-the-cross-validation" class="headerlink" title="Perform the cross validation"></a>Perform the cross validation</h4><pre class="line-numbers language-R" data-language="R"><code class="language-R">train(Reverse ~ Circuit + Issue + Petitioner + Respondent + LowerCourt + Unconst, data &#x3D; Train, method &#x3D; &quot;rpart&quot;, trControl &#x3D; numFolds, tuneGrid &#x3D; cpGrid )<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>CART 

396 samples
  6 predictor
  2 classes: &#39;0&#39;, &#39;1&#39; 

No pre-processing
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 357, 356, 356, 356, 356, 356, ... 
Resampling results across tuning parameters:

  cp    Accuracy   Kappa      
  0.01  0.6209615  0.219308080
  0.02  0.6308974  0.238358325
  0.03  0.6258974  0.238018757
  0.04  0.6386538  0.269706555
  0.05  0.6436538  0.282648474
  0.06  0.6436538  0.282648474
  0.07  0.6436538  0.282648474
  0.08  0.6436538  0.282648474
  0.09  0.6436538  0.282648474
  0.10  0.6436538  0.282648474
  0.11  0.6436538  0.282648474
  0.12  0.6436538  0.282648474
  0.13  0.6436538  0.282648474
  0.14  0.6436538  0.282648474
  0.15  0.6436538  0.282648474
  0.16  0.6436538  0.282648474
  0.17  0.6436538  0.282648474
  0.18  0.6436538  0.282648474
  0.19  0.6436538  0.282648474
  0.20  0.6257051  0.238726905
  0.21  0.5707051  0.092505117
  0.22  0.5604487  0.064158660
  0.23  0.5428205  0.001593625
  0.24  0.5428205  0.001593625
  0.25  0.5453846  0.000000000
  0.26  0.5453846  0.000000000
  0.27  0.5453846  0.000000000
  0.28  0.5453846  0.000000000
  0.29  0.5453846  0.000000000
  0.30  0.5453846  0.000000000
  0.31  0.5453846  0.000000000
  0.32  0.5453846  0.000000000
  0.33  0.5453846  0.000000000
  0.34  0.5453846  0.000000000
  0.35  0.5453846  0.000000000
  0.36  0.5453846  0.000000000
  0.37  0.5453846  0.000000000
  0.38  0.5453846  0.000000000
  0.39  0.5453846  0.000000000
  0.40  0.5453846  0.000000000
  0.41  0.5453846  0.000000000
  0.42  0.5453846  0.000000000
  0.43  0.5453846  0.000000000
  0.44  0.5453846  0.000000000
  0.45  0.5453846  0.000000000
  0.46  0.5453846  0.000000000
  0.47  0.5453846  0.000000000
  0.48  0.5453846  0.000000000
  0.49  0.5453846  0.000000000
  0.50  0.5453846  0.000000000

Accuracy was used to select the optimal model using  the largest value.
The final value used for the model was cp = 0.19.
</code></pre><p>最佳参数为0.19，利用这个参数来训练模型。</p>
<h4 id="Create-a-new-CART-model"><a href="#Create-a-new-CART-model" class="headerlink" title="Create a new CART model"></a>Create a new CART model</h4><pre class="line-numbers language-R" data-language="R"><code class="language-R">StevensTreeCV &#x3D; rpart(Reverse ~ Circuit + Issue + Petitioner + Respondent + LowerCourt + Unconst, data &#x3D; Train, method&#x3D;&quot;class&quot;, cp &#x3D; 0.19)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="Make-predictions-1"><a href="#Make-predictions-1" class="headerlink" title="Make predictions"></a>Make predictions</h4><pre class="line-numbers language-R" data-language="R"><code class="language-R">PredictCV &#x3D; predict(StevensTreeCV, newdata &#x3D; Test, type &#x3D; &quot;class&quot;)
table(Test$Reverse, PredictCV)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>   PredictCV
     0  1
  0 59 18
  1 29 64
</code></pre><p>最后补充Penalty Matrix的概念。</p>
<h4 id="Penalty-Matrix"><a href="#Penalty-Matrix" class="headerlink" title="Penalty Matrix"></a>Penalty Matrix</h4><p><img src= "/img/loading.gif" data-lazy-src="https://github.com/Doraemonzzz/md-photo/blob/master/The%20Analytics%20Edge/Unit%204/2018102202.png?raw=true" alt=""></p>
<p>Penalty Matrix主要是给不同的错徐赋予不同的权重，这样可以定义新的损失函数，来看具体做法：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">PenaltyMatrix &#x3D; matrix(c(0,1,2,0), byrow&#x3D;TRUE, nrow&#x3D;2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>计算误差。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">as.matrix(table(Test$Reverse, PredictCV))*PenaltyMatrix<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>   PredictCV
     0  1
  0  0 18
  1 58  0
</code></pre></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Doraemonzzz</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://www.doraemonzzz.com/2018/10/22/Unit%204%20Trees/">http://www.doraemonzzz.com/2018/10/22/Unit%204%20Trees/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://www.doraemonzzz.com" target="_blank">Doraemonzzz</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/The-Analytics-Edge/">The Analytics Edge</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2018/10/22/Introduction%20to%20Deep%20Learning%20week%204/"><img class="prev-cover" src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Introduction to Deep Learning week 4</div></div></a></div><div class="next-post pull-right"><a href="/2018/10/21/Neural%20Networks%20for%20Machine%20Learning%20Lecture%2015/"><img class="next-cover" src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Neural Networks for Machine Learning Lecture 15</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2018/10/07/Unit 2 Linear Regression/" title="Unit 2 Linear Regression"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-10-07</div><div class="title">Unit 2 Linear Regression</div></div></a></div><div><a href="/2018/10/06/Unit 1 An Introduction to Analytics/" title="Unit 1 An Introduction to Analytics"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-10-06</div><div class="title">Unit 1 An Introduction to Analytics</div></div></a></div><div><a href="/2018/10/15/Unit 3 Logistic Regression/" title="Unit 3 Logistic Regression"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-10-15</div><div class="title">Unit 3 Logistic Regression</div></div></a></div><div><a href="/2018/11/04/Unit 5 Text Analytics/" title="Unit 5 Text Analytics"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-11-04</div><div class="title">Unit 5 Text Analytics</div></div></a></div><div><a href="/2018/11/07/Unit 6 Clustering/" title="Unit 6 Clustering"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-11-07</div><div class="title">Unit 6 Clustering</div></div></a></div><div><a href="/2018/11/27/Unit 7 Visualization/" title="Unit 7 Visualization"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-11-27</div><div class="title">Unit 7 Visualization</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Livere</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="lv-container" data-id="city" data-uid="MTAyMC8zNDcxOS8xMTI1Ng=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src= "/img/loading.gif" data-lazy-src="https://github.com/Doraemonzzz/md-photo/blob/master/%E5%A4%B4%E5%83%8F.jpg?raw=true" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Doraemonzzz</div><div class="author-info__description">个人博客，主要记录有关机器学习，数学以及计算机科学的笔记</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">664</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">68</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">26</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Doraemonzzz"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Doraemonzzz" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/doraemon_zzz@163.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://space.bilibili.com/291079982" target="_blank" title="Bilibili"><i class="iconfont icon-bilibili"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title=""><i class="fa fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">暂无公告</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#Split-the-data"><span class="toc-number">1.</span> <span class="toc-text">Split the data</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Install-rpart-library"><span class="toc-number">2.</span> <span class="toc-text">Install rpart library</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CART-model"><span class="toc-number">3.</span> <span class="toc-text">CART model</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Make-predictions"><span class="toc-number">4.</span> <span class="toc-text">Make predictions</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ROC-curve"><span class="toc-number">5.</span> <span class="toc-text">ROC curve</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Random-Forest"><span class="toc-number">6.</span> <span class="toc-text">Random Forest</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Make-predictions-again"><span class="toc-number">7.</span> <span class="toc-text">Make predictions again</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cross-validation"><span class="toc-number">8.</span> <span class="toc-text">cross-validation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Define-cross-validation-experiment"><span class="toc-number">9.</span> <span class="toc-text">Define cross-validation experiment</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Perform-the-cross-validation"><span class="toc-number">10.</span> <span class="toc-text">Perform the cross validation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Create-a-new-CART-model"><span class="toc-number">11.</span> <span class="toc-text">Create a new CART model</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Make-predictions-1"><span class="toc-number">12.</span> <span class="toc-text">Make predictions</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Penalty-Matrix"><span class="toc-number">13.</span> <span class="toc-text">Penalty Matrix</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/09/22/2021-9-22-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC11%E7%AB%A0-%E4%B9%A0%E9%A2%98%E8%A7%A3%E6%9E%90/" title="深入理解计算机系统 第11章 习题解析"><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="深入理解计算机系统 第11章 习题解析"/></a><div class="content"><a class="title" href="/2021/09/22/2021-9-22-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC11%E7%AB%A0-%E4%B9%A0%E9%A2%98%E8%A7%A3%E6%9E%90/" title="深入理解计算机系统 第11章 习题解析">深入理解计算机系统 第11章 习题解析</a><time datetime="2021-09-22T15:10:00.000Z" title="发表于 2021-09-22 23:10:00">2021-09-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/09/22/2021-9-22-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC11%E7%AB%A0-%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/" title="深入理解计算机系统 第11章 笔记整理"><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="深入理解计算机系统 第11章 笔记整理"/></a><div class="content"><a class="title" href="/2021/09/22/2021-9-22-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC11%E7%AB%A0-%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/" title="深入理解计算机系统 第11章 笔记整理">深入理解计算机系统 第11章 笔记整理</a><time datetime="2021-09-22T00:55:00.000Z" title="发表于 2021-09-22 08:55:00">2021-09-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/09/21/2021-9-21-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC10%E7%AB%A0-%E4%B9%A0%E9%A2%98%E8%A7%A3%E6%9E%90/" title="深入理解计算机系统 第10章 习题解析"><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="深入理解计算机系统 第10章 习题解析"/></a><div class="content"><a class="title" href="/2021/09/21/2021-9-21-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC10%E7%AB%A0-%E4%B9%A0%E9%A2%98%E8%A7%A3%E6%9E%90/" title="深入理解计算机系统 第10章 习题解析">深入理解计算机系统 第10章 习题解析</a><time datetime="2021-09-21T15:29:00.000Z" title="发表于 2021-09-21 23:29:00">2021-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/09/21/2021-9-21-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC10%E7%AB%A0-%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/" title="深入理解计算机系统 第10章 笔记整理"><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="深入理解计算机系统 第10章 笔记整理"/></a><div class="content"><a class="title" href="/2021/09/21/2021-9-21-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC10%E7%AB%A0-%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86/" title="深入理解计算机系统 第10章 笔记整理">深入理解计算机系统 第10章 笔记整理</a><time datetime="2021-09-21T09:51:00.000Z" title="发表于 2021-09-21 17:51:00">2021-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/09/16/2021-9-16-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC9%E7%AB%A0-%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86-p2/" title="深入理解计算机系统 第9章 笔记整理 p2"><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="深入理解计算机系统 第9章 笔记整理 p2"/></a><div class="content"><a class="title" href="/2021/09/16/2021-9-16-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC9%E7%AB%A0-%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86-p2/" title="深入理解计算机系统 第9章 笔记整理 p2">深入理解计算机系统 第9章 笔记整理 p2</a><time datetime="2021-09-15T16:36:00.000Z" title="发表于 2021-09-16 00:36:00">2021-09-16</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2021 By Doraemonzzz</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.25
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'IpnmxCW9CvYWIXbol5QXsegX-MdYXbMMI',
      appKey: 'w57DVCdbxcyB1TYYagMIMJIU',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: true
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Valine' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>